---
title: Nçš‡åé—®é¢˜
icon: fas fa-m
author: è·¯ä¹é˜³
order: 7
category:
  - æ•™å­¦æ–‡æ¡£
tag:
  - å›æº¯ä¸åˆ†æ”¯é™ç•Œ-dfs
---

## Nçš‡åé—®é¢˜
### é¢˜ç›®æè¿° 

![picture 0](https://oss.docs.z-xin.net/4620afeafda6e4f1f77bb1b7939324b766c80de0d0669944fd924805545423b7.png)  




### è§£é¢˜æ€è·¯ï¼ˆå›æº¯æ³• Backtrackingï¼‰

n çš‡åé—®é¢˜è¦æ±‚åœ¨ **n Ã— n æ£‹ç›˜** ä¸Šæ”¾ç½® **n ä¸ªçš‡å**ï¼Œä½¿å¾—ï¼š

* ä»»ä½•ä¸¤ä¸ªçš‡åä¸èƒ½åœ¨ **åŒä¸€è¡Œ**
* ä¸èƒ½åœ¨ **åŒä¸€åˆ—**
* ä¸èƒ½åœ¨ **åŒä¸€æ–œçº¿ï¼ˆä¸¤ç§æ–œçº¿ï¼‰**

---

#### ğŸŒŸ å…³é”®è§‚å¯Ÿï¼š

æˆ‘ä»¬å°† **ä¸€è¡Œä¸€è¡Œæ”¾ç½®çš‡å**ã€‚

* è¡Œå·å›ºå®šåï¼Œåªéœ€å†³å®šçš‡åæ”¾åœ¨å“ªä¸€åˆ—ã€‚
* æˆ‘ä»¬éœ€è¦è®°å½•å“ªäº›åˆ—/æ–œçº¿å·²è¢«å ç”¨ã€‚

#### å¦‚ä½•åˆ¤æ–­æ–œçº¿ï¼Ÿ

å¯¹äºä½ç½® (row, col)ï¼š

| æ–œçº¿ç±»å‹           | æ•°å­¦ç‰¹æ€§           | ç”¨æ¥åˆ¤å®šå†²çª          |
| -------------- | -------------- | --------------- |
| ä¸»å¯¹è§’çº¿ï¼ˆâ†˜ï¼Œä»å·¦ä¸Šåˆ°å³ä¸‹ï¼‰ | row - col = å¸¸æ•° | ç”¨ä¸€ä¸ªé›†åˆè®°å½•ï¼š`diag1` |
| å‰¯å¯¹è§’çº¿ï¼ˆâ†™ï¼Œä»å³ä¸Šåˆ°å·¦ä¸‹ï¼‰ | row + col = å¸¸æ•° | ç”¨ä¸€ä¸ªé›†åˆè®°å½•ï¼š`diag2` |

æ‰€ä»¥åªè¦ **åˆ—ã€ä¸»å¯¹è§’çº¿ã€å‰¯å¯¹è§’çº¿** ä¹‹ä¸€å†²çªï¼Œå°±ä¸èƒ½æ”¾çš‡åã€‚

---

#### ğŸŒŸ å›æº¯ç®—æ³•çš„ç»“æ„ï¼š

```
def backtrack(row):
    å¦‚æœ row == nï¼š
        æ‰¾åˆ°ä¸€ä¸ªå®Œæ•´è§£ï¼ŒåŠ å…¥ç­”æ¡ˆ
        return

    å¯¹åˆ— col ä» 0 åˆ° n-1:
        å¦‚æœè¯¥åˆ—å’Œæ–œçº¿éƒ½å®‰å…¨:
            æ”¾çš‡å
            è¿›å…¥ä¸‹ä¸€è¡Œ backtrack(row + 1)
            æ’¤é”€çš‡åï¼ˆå›æº¯ï¼‰
```

---

### Python ä»£ç 

```python
def solveNQueens(n):
    results = []
    board = ["." * n for _ in range(n)]

    cols = set()      # å·²å ç”¨çš„åˆ—
    diag1 = set()     # ä¸»å¯¹è§’çº¿ row - col
    diag2 = set()     # å‰¯å¯¹è§’çº¿ row + col

    def backtrack(row):
        if row == n:
            results.append(board.copy())
            return

        for col in range(n):
            if col in cols or (row - col) in diag1 or (row + col) in diag2:
                continue

            # æ”¾ç½®çš‡å
            cols.add(col)
            diag1.add(row - col)
            diag2.add(row + col)

            board[row] = board[row][:col] + "Q" + board[row][col+1:]

            # ä¸‹ä¸€è¡Œ
            backtrack(row + 1)

            # å›æº¯ï¼ˆæ’¤é”€ï¼‰
            cols.remove(col)
            diag1.remove(row - col)
            diag2.remove(row + col)

            board[row] = board[row][:col] + "." + board[row][col+1:]

    backtrack(0)
    return results


# æµ‹è¯•
print(solveNQueens(4))
```

---

#### ç¤ºä¾‹è¾“å‡ºï¼ˆn=4ï¼‰

```
[
 [".Q..",
  "...Q",
  "Q...",
  "..Q."],

 ["..Q.",
  "Q...",
  "...Q",
  ".Q.."]
]
```

---

#### æ—¶é—´å¤æ‚åº¦

* æœ€åæ—¶é—´å¤æ‚åº¦ï¼šO(n!)
* ç©ºé—´å¤æ‚åº¦ï¼šO(n)

è¿™æ˜¯æ ‡å‡†çš„ n çš‡åå›æº¯ç®—æ³•ï¼Œæ•ˆç‡é«˜ã€å®ç°ç®€æ´ã€‚



