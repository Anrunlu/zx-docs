---

title: ç¬¬9æ¬¡è¯¾ 
icon: iconfont icon-a-outline-harmony-one  
author: å‘¨å­åŠ›  
order: 9  
category:
    -   æ•™å­¦æ–‡æ¡£  
tag:
    -   HarmonyOS

---


## è¯¾å‰å›é¡¾

1.æ•°æ®æŒä¹…åŒ–ï¼Œæ¯”å¦‚åœ¨å¤‡å¿˜å½•åº”ç”¨ä¸­ï¼Œå½“ç”¨æˆ·æ·»åŠ ã€åˆ é™¤ã€ä¿®æ”¹äº†æ•°æ®æ—¶ï¼Œæ•°æ®éœ€è¦æŒä¹…åŒ–åˆ°æœ¬åœ°ã€‚

2.preferenceçš„ä½¿ç”¨ï¼Œæ¯”å¦‚åœ¨å¤‡å¿˜å½•åº”ç”¨ä¸­ï¼Œç”¨æˆ·è®¾ç½®ä¸»é¢˜è‰²æ—¶ï¼Œéœ€è¦ä¿å­˜åˆ°æœ¬åœ°ã€‚

åœ¨é¸¿è’™ï¼ˆHarmonyOSï¼‰åº”ç”¨å¼€å‘ä¸­ï¼Œ**Preferenceé¦–é€‰é¡¹**æ˜¯ä¸€ç§è½»é‡çº§çš„æ•°æ®æŒä¹…åŒ–å­˜å‚¨æ–¹æ¡ˆï¼Œä¸»è¦ç”¨äºå­˜å‚¨å°‘é‡ã€ç®€å•çš„é”®å€¼å¯¹æ•°æ®ã€‚ä»¥ä¸‹æ˜¯å…³äºPreferenceé¦–é€‰é¡¹çš„è¯¦ç»†é˜è¿°ï¼š

## 1. Preferenceé¦–é€‰é¡¹æ¦‚è¿°

Preferenceæ˜¯ä¸€ç§åŸºäºé”®å€¼å¯¹ï¼ˆKey-Valueï¼‰çš„è½»é‡çº§å­˜å‚¨æœºåˆ¶ï¼Œé€‚ç”¨äºä¿å­˜åº”ç”¨çš„é…ç½®ä¿¡æ¯ã€ç”¨æˆ·è®¾ç½®ç­‰å°è§„æ¨¡æ•°æ®ã€‚

**ç‰¹ç‚¹ï¼š**
- æ•°æ®ä»¥XMLæ–‡ä»¶å½¢å¼å­˜å‚¨
- çº¿ç¨‹å®‰å…¨ï¼Œæ”¯æŒå¼‚æ­¥æ“ä½œ
- å­˜å‚¨ç®€å•æ•°æ®ç±»å‹
- è‡ªåŠ¨æŒä¹…åŒ–åˆ°è®¾å¤‡å­˜å‚¨

## 2. åŸºæœ¬ä½¿ç”¨æ–¹æ³•

### 2.1 è·å–Preferenceå®ä¾‹

```typescript
import preferences from '@ohos.data.preferences';

// è·å–Preferenceå®ä¾‹
let preferences: Promise<preferences.Preferences> = preferences.getPreferences(this.context, 'myAppPrefs');
```

### 2.2 å­˜å‚¨æ•°æ®

```typescript
async function saveData() {
  try {
    let pref = await preferences.getPreferences(this.context, 'myAppPrefs');
    
    // å­˜å‚¨ä¸åŒç±»å‹çš„æ•°æ®
    await pref.put('username', 'å¼ ä¸‰');
    await pref.put('age', 25);
    await pref.put('isLoggedIn', true);
    await pref.put('score', 95.5);
    
    // æäº¤ä¿å­˜
    await pref.flush();
    console.log('æ•°æ®ä¿å­˜æˆåŠŸ');
  } catch (err) {
    console.error('ä¿å­˜æ•°æ®å¤±è´¥: ' + err);
  }
}
```

### 2.3 è¯»å–æ•°æ®

```typescript
async function readData() {
  try {
    let pref = await preferences.getPreferences(this.context, 'myAppPrefs');
    
    // è¯»å–æ•°æ®ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºé»˜è®¤å€¼
    let username = await pref.get('username', 'é»˜è®¤ç”¨æˆ·');
    let age = await pref.get('age', 0);
    let isLoggedIn = await pref.get('isLoggedIn', false);
    let score = await pref.get('score', 0.0);
    
    console.log(`ç”¨æˆ·å: ${username}`);
    console.log(`å¹´é¾„: ${age}`);
    console.log(`ç™»å½•çŠ¶æ€: ${isLoggedIn}`);
    console.log(`åˆ†æ•°: ${score}`);
  } catch (err) {
    console.error('è¯»å–æ•°æ®å¤±è´¥: ' + err);
  }
}
```

## 3. å®Œæ•´ç¤ºä¾‹ä»£ç 

```typescript
import preferences from '@ohos.data.preferences';

export default class PreferenceUtils {
  private static PREF_NAME = 'myAppPreferences';
  
  // ä¿å­˜ç”¨æˆ·ä¿¡æ¯
  static async saveUserInfo(userInfo: UserInfo) {
    try {
      let pref = await preferences.getPreferences(getContext(), this.PREF_NAME);
      
      await pref.put('userId', userInfo.id);
      await pref.put('userName', userInfo.name);
      await pref.put('userEmail', userInfo.email);
      await pref.put('loginTime', Date.now());
      await pref.put('rememberMe', userInfo.rememberMe);
      
      await pref.flush();
      console.log('ç”¨æˆ·ä¿¡æ¯ä¿å­˜æˆåŠŸ');
    } catch (err) {
      console.error('ä¿å­˜ç”¨æˆ·ä¿¡æ¯å¤±è´¥: ' + err);
    }
  }
  
  // è¯»å–ç”¨æˆ·ä¿¡æ¯
  static async getUserInfo(): Promise<UserInfo> {
    try {
      let pref = await preferences.getPreferences(getContext(), this.PREF_NAME);
      
      return {
        id: await pref.get('userId', ''),
        name: await pref.get('userName', ''),
        email: await pref.get('userEmail', ''),
        loginTime: await pref.get('loginTime', 0),
        rememberMe: await pref.get('rememberMe', false)
      };
    } catch (err) {
      console.error('è¯»å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥: ' + err);
      return new UserInfo();
    }
  }
  
  // åˆ é™¤æŒ‡å®šæ•°æ®
  static async deleteKey(key: string) {
    try {
      let pref = await preferences.getPreferences(getContext(), this.PREF_NAME);
      await pref.delete(key);
      await pref.flush();
    } catch (err) {
      console.error('åˆ é™¤æ•°æ®å¤±è´¥: ' + err);
    }
  }
  
  // æ¸…ç©ºæ‰€æœ‰æ•°æ®
  static async clearAll() {
    try {
      let pref = await preferences.getPreferences(getContext(), this.PREF_NAME);
      await pref.clear();
      await pref.flush();
    } catch (err) {
      console.error('æ¸…ç©ºæ•°æ®å¤±è´¥: ' + err);
    }
  }
}

class UserInfo {
  id: string = '';
  name: string = '';
  email: string = '';
  loginTime: number = 0;
  rememberMe: boolean = false;
}
```

## 4. é«˜çº§ç”¨æ³•

### 4.1 æ•°æ®å˜æ›´ç›‘å¬

```typescript
async function setupPreferenceListener() {
  try {
    let pref = await preferences.getPreferences(this.context, 'myAppPrefs');
    
    // æ·»åŠ æ•°æ®å˜æ›´ç›‘å¬å™¨
    pref.on('change', (key: string) => {
      console.log(`æ•°æ®å‘ç”Ÿå˜åŒ–: ${key}`);
      // æ‰§è¡Œç›¸åº”çš„ä¸šåŠ¡é€»è¾‘
    });
  } catch (err) {
    console.error('è®¾ç½®ç›‘å¬å™¨å¤±è´¥: ' + err);
  }
}
```

### 4.2 å¤šPreferenceæ–‡ä»¶ç®¡ç†

```typescript
class MultiPreferenceManager {
  private static USER_PREF = 'user_preferences';
  private static APP_PREF = 'app_preferences';
  private static CACHE_PREF = 'cache_preferences';
  
  // è·å–ä¸åŒçš„Preferenceæ–‡ä»¶
  static async getUserPreferences() {
    return await preferences.getPreferences(getContext(), this.USER_PREF);
  }
  
  static async getAppPreferences() {
    return await preferences.getPreferences(getContext(), this.APP_PREF);
  }
  
  static async getCachePreferences() {
    return await preferences.getPreferences(getContext(), this.CACHE_PREF);
  }
}
```

## 5. æœ€ä½³å®è·µ

### 5.1 å°è£…å·¥å…·ç±»

```typescript
export class PreferenceHelper {
  private prefName: string;
  
  constructor(prefName: string) {
    this.prefName = prefName;
  }
  
  // å®‰å…¨åœ°ä¿å­˜æ•°æ®
  async safePut(key: string, value: preferences.ValueType): Promise<boolean> {
    try {
      let pref = await preferences.getPreferences(getContext(), this.prefName);
      await pref.put(key, value);
      await pref.flush();
      return true;
    } catch (err) {
      console.error(`ä¿å­˜æ•°æ®å¤±è´¥ key:${key}`, err);
      return false;
    }
  }
  
  // å®‰å…¨åœ°è¯»å–æ•°æ®
  async safeGet<T extends preferences.ValueType>(key: string, defaultValue: T): Promise<T> {
    try {
      let pref = await preferences.getPreferences(getContext(), this.prefName);
      return await pref.get(key, defaultValue) as T;
    } catch (err) {
      console.error(`è¯»å–æ•°æ®å¤±è´¥ key:${key}`, err);
      return defaultValue;
    }
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const appPrefs = new PreferenceHelper('app_settings');
await appPrefs.safePut('theme', 'dark');
let theme = await appPrefs.safeGet('theme', 'light');
```

## 6. é€‚ç”¨åœºæ™¯

- âœ… **é€‚åˆ**ï¼šç”¨æˆ·è®¾ç½®ã€åº”ç”¨é…ç½®ã€ç™»å½•çŠ¶æ€ã€ç®€å•çš„ç”¨æˆ·æ•°æ®
- âŒ **ä¸é€‚åˆ**ï¼šå¤§é‡ç»“æ„åŒ–æ•°æ®ã€å¤æ‚æŸ¥è¯¢ã€å…³ç³»å‹æ•°æ®

## æ€»ç»“

Preferenceé¦–é€‰é¡¹æ˜¯é¸¿è’™åº”ç”¨å¼€å‘ä¸­æœ€ç®€å•æ˜“ç”¨çš„æ•°æ®æŒä¹…åŒ–æ–¹æ¡ˆï¼Œé€‚åˆå­˜å‚¨å°è§„æ¨¡çš„é…ç½®æ•°æ®å’Œç”¨æˆ·åå¥½è®¾ç½®ã€‚é€šè¿‡åˆç†çš„å°è£…å’Œé”™è¯¯å¤„ç†ï¼Œå¯ä»¥æ„å»ºç¨³å®šå¯é çš„æ•°æ®å­˜å‚¨é€»è¾‘ã€‚


## æœ¬å‘¨å†…å®¹

åœ¨é¸¿è’™ï¼ˆHarmonyOSï¼‰åº”ç”¨å¼€å‘ä¸­ï¼Œ`axios` æ˜¯ä¸€ä¸ªåŸºäº Promise çš„ç½‘ç»œè¯·æ±‚åº“ï¼Œå®ƒå¯ä»¥å¸®åŠ©ä½ æ›´ç®€æ´ã€é«˜æ•ˆåœ°å¤„ç† HTTP è¯·æ±‚ ã€‚ä¸‹é¢æˆ‘å°†ä¸ºä½ ä»‹ç»å¦‚ä½•åœ¨é¸¿è’™é¡¹ç›®ä¸­å®‰è£…ã€é…ç½®å’Œä½¿ç”¨ `axios`ã€‚

### ğŸ”§ å®‰è£…ä¸åŸºç¡€é…ç½®

åœ¨é¸¿è’™é¡¹ç›®ä¸­ä½¿ç”¨ `axios` å‰ï¼Œä½ éœ€è¦å…ˆå®Œæˆå®‰è£…å’Œæƒé™é…ç½®ã€‚

1.  **å®‰è£… Axios**
    åœ¨é¸¿è’™é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹ï¼Œé€šè¿‡ä»¥ä¸‹å‘½ä»¤ä½¿ç”¨ OpenHarmony Package Manager (ohpm) è¿›è¡Œå®‰è£… ï¼š
    ```bash
    ohpm install @ohos/axios
    ```

2.  **é…ç½®ç½‘ç»œæƒé™**
    ä¸ºäº†åº”ç”¨èƒ½å¤Ÿè®¿é—®ç½‘ç»œï¼Œä½ éœ€è¦åœ¨ `module.json5` æ–‡ä»¶ä¸­å£°æ˜ç½‘ç»œæƒé™ ã€‚
    ```json
    "requestPermissions": [
      {
        "name": "ohos.permission.INTERNET"
      }
    ]
    ```

### ğŸš€ å‘èµ·ç½‘ç»œè¯·æ±‚

å®‰è£…å’Œé…ç½®å®Œæˆåï¼Œä½ å°±å¯ä»¥å¼€å§‹ä½¿ç”¨ `axios` å‘èµ·ç½‘ç»œè¯·æ±‚äº†ã€‚

1.  **å¼•å…¥ Axios**
    åœ¨ä½¿ç”¨ `axios` çš„é¡µé¢æˆ–å·¥å…·æ–‡ä»¶ä¸­ï¼Œé¦–å…ˆéœ€è¦å¼•å…¥å®ƒ ï¼š
    ```typescript
    import axios from '@ohos/axios';
    ```

2.  **å‘èµ· GET è¯·æ±‚**
    ä½¿ç”¨ `axios.get` æ–¹æ³•å‘èµ· GET è¯·æ±‚ ï¼š
    ```typescript
    axios.get('https://api.example.com/data')
      .then(response => {
        // è¯·æ±‚æˆåŠŸï¼Œå¤„ç†å“åº”æ•°æ®
        console.log(response.data);
      })
      .catch(error => {
        // è¯·æ±‚å¤±è´¥ï¼Œå¤„ç†é”™è¯¯
        console.error(error);
      });
    ```

3.  **å‘èµ· POST è¯·æ±‚**
    ä½¿ç”¨ `axios.post` æ–¹æ³•å‘èµ· POST è¯·æ±‚ ï¼š
    ```typescript
    axios.post('https://api.example.com/submit', { name: 'Alice', age: 30 })
      .then(response => {
        console.log('Submit Success:', response.data);
      })
      .catch(error => {
        console.error('Request Failed:', error);
      });
    ```

### ğŸ’¡ è¿›é˜¶ç”¨æ³•ä¸æœ€ä½³å®è·µ

ä¸ºäº†åœ¨å¤§å‹é¡¹ç›®ä¸­æ›´å¥½åœ°ç®¡ç†ç½‘ç»œè¯·æ±‚ï¼Œå»ºè®®è¿›è¡Œæ›´å®Œå–„çš„å°è£…å’Œé…ç½®ã€‚

1.  **åˆ›å»º Axios å®ä¾‹**
    ä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªé…ç½®å¥½çš„ Axios å®ä¾‹ï¼Œè®¾ç½®å…¬å…±çš„åŸºè·¯å¾„ï¼ˆbaseURLï¼‰å’Œè¶…æ—¶æ—¶é—´ ï¼š
    ```typescript
    const instance = axios.create({
      baseURL: 'https://api.yourdomain.com', // ä½ çš„æ¥å£åŸºåœ°å€
      timeout: 60000 // è¶…æ—¶æ—¶é—´ï¼Œå•ä½æ¯«ç§’
    });
    ```

2.  **ä½¿ç”¨è¯·æ±‚å’Œå“åº”æ‹¦æˆªå™¨**
    æ‹¦æˆªå™¨è®©ä½ èƒ½åœ¨è¯·æ±‚å‘å‡ºå‰æˆ–å“åº”è¿”å›åï¼Œè¿›è¡Œç»Ÿä¸€çš„é¢„å¤„ç†ï¼Œä¾‹å¦‚è‡ªåŠ¨æ·»åŠ èº«ä»½éªŒè¯ä»¤ç‰Œï¼ˆTokenï¼‰æˆ–ç»Ÿä¸€å¤„ç†é”™è¯¯ ã€‚
    
    **è¯·æ±‚æ‹¦æˆªå™¨**ç¤ºä¾‹ï¼š
    ```typescript
    instance.interceptors.request.use((config) => {
      // åœ¨å‘é€è¯·æ±‚å‰åšäº›ä»€ä¹ˆï¼Œä¾‹å¦‚æ·»åŠ token
      const token = '...'; // ä»æœ¬åœ°è·å–tokençš„é€»è¾‘
      if (token) {
        config.headers.token = token; // å°†tokenæ·»åŠ åˆ°è¯·æ±‚å¤´
      }
      return config;
    }, (error) => {
      // å¯¹è¯·æ±‚é”™è¯¯åšäº›ä»€ä¹ˆ
      return Promise.reject(error);
    });
    ```
    
    **å“åº”æ‹¦æˆªå™¨**ç¤ºä¾‹ï¼š
    ```typescript
    instance.interceptors.response.use((response: AxiosResponse) => {
      // å¯¹å“åº”æ•°æ®åšç‚¹ä»€ä¹ˆï¼Œä¾‹å¦‚æ ¹æ®ä¸šåŠ¡ä»£ç ç»Ÿä¸€å¤„ç†
      let data = response.data;
      if (data.code === 200) {
        return data; // ä¸šåŠ¡æˆåŠŸï¼Œè¿”å›æ•°æ®
      } else {
        // ä¸šåŠ¡å¼‚å¸¸ï¼Œå¯ä»¥åœ¨æ­¤æ˜¾ç¤ºToastæç¤º
        console.error('Request failed with message:', data.msg);
        return Promise.reject(new Error(data.msg));
      }
    }, (error) => {
      // å¯¹å“åº”é”™è¯¯åšç‚¹ä»€ä¹ˆï¼Œä¾‹å¦‚å¤„ç†HTTPçŠ¶æ€ç é200çš„æƒ…å†µ
      console.error('Network error:', error);
      return Promise.reject(error);
    });
    ```

3.  **å¯¹è¯·æ±‚å‚æ•°å’Œå“åº”æ•°æ®è¿›è¡Œç±»å‹çº¦æŸ**
    åœ¨ ArkTS ä¸­ï¼Œæ¨èä½¿ç”¨æ³›å‹æ¥å®šä¹‰è¯·æ±‚å‚æ•°å’Œå“åº”æ•°æ®çš„ç±»å‹ï¼Œä»¥è·å¾—æ›´å¥½çš„ç±»å‹å®‰å…¨å’Œä»£ç æç¤º ã€‚
    
    **å®šä¹‰æ¥å£**ï¼š
    ```typescript
    // å®šä¹‰è¯·æ±‚å‚æ•°ç±»å‹
    interface LoginRequest {
      phone: string;
      passwd: string;
    }
    
    // å®šä¹‰å“åº”æ•°æ®ç±»å‹
    interface LoginResponse {
      code: number;
      msg: string;
      token: string;
    }
    ```
    
    **åœ¨è¯·æ±‚ä¸­ä½¿ç”¨æ³›å‹**ï¼š
    ```typescript
    // åœ¨postè¯·æ±‚ä¸­ï¼Œä¸‰ä¸ªæ³›å‹å‚æ•°ä¾æ¬¡ä¸ºï¼šå“åº”æ•°æ®ç±»å‹ã€AxiosResponseç±»å‹ã€è¯·æ±‚å‚æ•°ç±»å‹
    const response = await instance.post<LoginResponse, AxiosResponse<LoginResponse, null>, LoginRequest>('/user/login', {
      phone: '13166666666',
      passwd: 'yourpassword'
    });
    console.log(response.token); // æ­¤æ—¶æœ‰ç±»å‹æç¤º
    ```

### ğŸ’ å°è£…ä¸å®è·µå»ºè®®

- **å°è£…å·¥å…·ç±»**ï¼šå»ºè®®å°† `axios` å®ä¾‹å’Œé€šç”¨é…ç½®å°è£…æˆä¸€ä¸ªç‹¬ç«‹çš„å·¥å…·ç±»ï¼ˆå¦‚ `BaseRequest`ï¼‰ï¼Œæ–¹ä¾¿åœ¨æ•´ä¸ªé¡¹ç›®ä¸­ç»Ÿä¸€ç®¡ç†å’Œä½¿ç”¨ ã€‚
- **ç»“åˆä¸šåŠ¡é€»è¾‘**ï¼šæ ¹æ®åç«¯æ¥å£è¿”å›çš„æ•°æ®ç»“æ„ï¼Œå°è£…é€šç”¨çš„å“åº”ç±»å‹ï¼Œå¹¶æŠ½å–é€šç”¨çš„è¯·æ±‚æ–¹æ³•ï¼Œé¿å…é‡å¤ä»£ç  ã€‚

`axios` é€šè¿‡å…¶ç®€æ´çš„ APIã€å¼ºå¤§çš„æ‹¦æˆªå™¨æœºåˆ¶å’Œè‰¯å¥½çš„ç±»å‹æ”¯æŒï¼Œèƒ½å¤Ÿæ˜¾è‘—æå‡é¸¿è’™åº”ç”¨å¼€å‘ä¸­ç½‘ç»œè¯·æ±‚çš„æ•ˆç‡ä¸å¯ç»´æŠ¤æ€§ ã€‚å¸Œæœ›è¿™äº›ä¿¡æ¯èƒ½å¸®åŠ©ä½ å¿«é€Ÿä¸Šæ‰‹ï¼å¦‚æœä½ å¯¹ç‰¹å®šåœºæ™¯ä¸‹çš„ä½¿ç”¨æ–¹æ³•æœ‰æ›´å¤šç–‘é—®ï¼Œæ¬¢è¿éšæ—¶æå‡ºã€‚